[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Project",
  "enabled": 1,
  "modified": "2026-01-15 10:43:46.117448",
  "module": null,
  "name": "FMG Project Resource Plan",
  "script": "frappe.ui.form.on('Project', {\r\n    refresh: function(frm) {\r\n        // Set query for custom_type_of_flooring field\r\n        frm.set_query(\"custom_type_of_flooring\", function() {\r\n            return {\r\n                filters: {\r\n                    name: [\"in\", [\"F-1 CLS\", \"F-1 SMGT\", \"F-1 ADV\", \"F-1 ADV Jointless\"]]\r\n                }\r\n            };\r\n        });\r\n    }\r\n});\r\n\r\n/* =====================================================================\r\n   AUTO BUILD RESOURCE PLAN BASED ON FLOORING TYPE\r\n   (NO CHANGE TO EXISTING LOGIC)\r\n===================================================================== */\r\n\r\n/*\r\n Mapping:\r\n Flooring Type  ->  Item Codes\r\n*/\r\nconst FLOORING_TYPE_ITEM_MAP = {\r\n    // \"F-1 ADV\": [\"F-2.5.1\"],\r\n    // \"F-1 ADV\": [\"F-2\", \"F-3\", \"F-4\", \"F-11.1\"],\r\n    // \"F-1 ADV\": [\"F-1.1\", \"F-2\", \"F-3.1\", \"F-4\", \"F-4.1\", \"F-5.1\", \"F-6.1\", \"F-7\", \"F-8.1\", \"F-8.2\", \"F-9.1\", \"F-10.1\", \"F-11\", \"F-11.1\", \"F-12.1\", \"F-13.1\"],\r\n    \"F-1 ADV\": [\"F-1\", \"F-2\", \"F-3\", \"F-4\", \"F-5\", \"F-6\", \"F-7\", \"F-8\", \"F-9\", \"F-10\", \"F-11\", \"F-12\", \"F-13\"],\r\n    \"F-1 CLS\": [\"F-2.1\", \"F-3.1\", \"F-4\"],\r\n    \"F-1 SMGT\": [\"F-1\", \"F-2\", \"F-3\", \"F-4\", \"F-5\", \"F-6\", \"F-7\", \"F-8\", \"F-9\", \"F-10\", \"F-11\", \"F-12\", \"F-13\", \"F-14\", \"F-15\", \"F-16\", \"F-17\", \"F-18\"],\r\n    \"F-1 ADV Jointless\": [\"F-1\", \"F-2\", \"F-3\", \"F-4\", \"F-5\", \"F-6\", \"F-7\", \"F-8\", \"F-9\", \"F-10\", \"F-11\", \"F-12\", \"F-13\"],\r\n};\r\n\r\n/* =====================================================================\r\n   AUTO BUILD RESOURCE PLAN WITH FULL ITEM DATA\r\n===================================================================== */\r\nfrappe.ui.form.on(\"Project\", {\r\n    async custom_type_of_flooring(frm) {\r\n        let flooring_type = frm.doc.custom_type_of_flooring;\r\n        if (!flooring_type) return;\r\n\r\n        let item_codes = FLOORING_TYPE_ITEM_MAP[flooring_type];\r\n        if (!item_codes?.length) {\r\n            frappe.msgprint(`No items mapped for ${flooring_type}`);\r\n            return;\r\n        }\r\n\r\n        let wa = flt(frm.doc.custom_warehouse_area);\r\n        if (wa <= 0) {\r\n            frappe.msgprint(\"Please enter Floor Area first\");\r\n            frm.set_value(\"custom_type_of_flooring\", \"\");\r\n            return;\r\n        }\r\n\r\n        frappe.dom.freeze(\"Loading Items & Building Costingâ€¦\");\r\n\r\n        try {\r\n            // ðŸ”¥ Clear old data\r\n            frm.clear_table(\"custom_resource_plan\");\r\n            frm.clear_table(\"custom_material_coverage_details\");\r\n\r\n            // ðŸ”¥ Build resource plan using real Item master data\r\n            for (let item_code of item_codes) {\r\n                let item = await frappe.db.get_doc(\"Item\", item_code);\r\n\r\n                let row = frm.add_child(\"custom_resource_plan\");\r\n\r\n                // Core\r\n                row.item_code = item.name;\r\n                // row.item_name = item.item_name;\r\n                row.description = item.description || \"\";\r\n                row.uom = item.stock_uom;\r\n\r\n                // Optional safety\r\n                row.qty = 1;\r\n            }\r\n\r\n            frm.refresh_field(\"custom_resource_plan\");\r\n\r\n            // ðŸ”¥ Trigger your existing costing logic\r\n            for (let row of frm.doc.custom_resource_plan) {\r\n                await build_material_rows(\r\n                    frm,\r\n                    row.doctype,\r\n                    row.name\r\n                );\r\n            }\r\n\r\n            frappe.show_alert({\r\n                message: __(\"Flooring items loaded with details\"),\r\n                indicator: \"green\"\r\n            });\r\n\r\n        } catch (err) {\r\n            console.error(err);\r\n            frappe.msgprint(\"Error while loading item data. Check console.\");\r\n        } finally {\r\n            frappe.dom.unfreeze();\r\n        }\r\n    }\r\n});\r\n\r\n\r\n\r\n\r\n\r\n/* =====================================================================\r\n   FINAL COSTING SCRIPT (FRAPPE v15)\r\n   - All costs calculated per Material Coverage Details row\r\n   - Parent only aggregates totals\r\n===================================================================== */\r\n\r\n/* =====================================================================\r\n   PROJECT RESOURCE PLAN\r\n   (ONLY build rows on item select)\r\n===================================================================== */\r\nfrappe.ui.form.on(\"Project Resource Plan\", {\r\n    item_code(frm, cdt, cdn) {\r\n        build_material_rows(frm, cdt, cdn);\r\n       \r\n    }\r\n});\r\n\r\n// frappe.ui.form.on(\"Project\", {\r\n//     refresh(frm) {\r\n//         console.log(\"ðŸ”¥ Project Resource Plan refresh fired\");\r\n\r\n//         frm.add_custom_button(\r\n//             __(\"Recalculate Materials & Labor\"),\r\n//             () => {\r\n//                 recalc_all_child_rows(frm);\r\n//             },\r\n//             __(\"Actions\") // ðŸ‘ˆ group (important)\r\n//         );\r\n//     }\r\n// });\r\n\r\nfunction recalc_all_child_rows(frm) {\r\n    if (!frm.doc.custom_material_coverage_details?.length) {\r\n        frappe.msgprint(\"No Material Coverage rows found\");\r\n        return;\r\n    }\r\n\r\n    frappe.dom.freeze(\"Recalculatingâ€¦\");\r\n\r\n    frm.doc.custom_material_coverage_details.forEach(ch => {\r\n        recalc_child_row(frm, ch.doctype, ch.name);\r\n    });\r\n\r\n    frm.refresh_field(\"custom_material_coverage_details\");\r\n\r\n    frappe.dom.unfreeze();\r\n\r\n    // frappe.show_alert({\r\n    //     message: __(\"Recalculation completed\"),\r\n    //     indicator: \"green\"\r\n    // });\r\n}\r\n\r\n\r\n/* =====================================================================\r\n   BUILD MATERIAL ROWS\r\n===================================================================== */\r\nasync function build_material_rows(frm, cdt, cdn) {\r\n    let row = locals[cdt][cdn];\r\n    if (!row || !row.item_code) return;\r\n\r\n    let wa = flt(frm.doc.custom_warehouse_area);\r\n    if (wa <= 0) {\r\n        frappe.msgprint(\"Please enter Floor Area first\");\r\n        return;\r\n    }\r\n\r\n    if (row.__building) return;\r\n    row.__building = true;\r\n\r\n    try {\r\n        remove_old_children(frm, row.name);\r\n    \r\n        let item = await frappe.db.get_doc(\"Item\", row.item_code);\r\n        \r\n        if (!item.supplier_items?.length) return;\r\n\r\n        let prices = await frappe.db.get_list(\"Item Price\", {\r\n            filters: {\r\n                item_code: row.item_code,\r\n                price_list: \"Standard Buying\"\r\n            },\r\n            fields: [\"price_list_rate\"],\r\n            limit: 1\r\n        });\r\n\r\n        let unit_rate = prices.length ? flt(prices[0].price_list_rate) : 0;\r\n\r\n        for (let si of item.supplier_items) {\r\n            let cov = extractNumber(si.custom_conversions);\r\n            \r\n            let qty = 0;\r\n            \r\n                    \r\n            let thickness = flt(si.custom_floor_thickness);\r\n\r\n            if (si.custom_unit_req_po === \"Litre\") {\r\n                qty = cov ? wa * cov : wa;\r\n            } else if ([\"CUM\", \"Kg\"].includes(si.custom_unit_req_po)) {\r\n                qty = thickness > 0 ? wa * thickness : 0;\r\n            }\r\n\r\n\r\n            \r\n            frm.add_child(\"custom_material_coverage_details\", {\r\n                custom_linked_resource_row: row.name,\r\n                custom_product_used: si.custom_product_used,\r\n                custom_manufacturer_name: si.custom_manufacturer_name,\r\n                custom_product_name: si.custom_product_name,\r\n                custom_unit_req_po: si.custom_unit_req_po,\r\n                coverage_value: cov || 0,\r\n\r\n                // quantity_needed: 0,\r\n                quantity_needed: qty.toFixed(3),\r\n                unit_rate: unit_rate,\r\n                total_cost: (qty * unit_rate).toFixed(2)\r\n,\r\n\r\n                /* Material */\r\n                custom_floor_thickness: 0,\r\n                custom_material_margin_type: \"Percentage\",\r\n                custom_material_margin_value: 0,\r\n\r\n                /* Labor (INDIVIDUAL) */\r\n                labor_units: 0,\r\n                rate_per_unit: 0,\r\n                custom_labor_margin_type: \"Percentage\",\r\n                custom_labor_margin_value: 0,\r\n                final_labor_cost: 0\r\n            });\r\n        }\r\n\r\n        frm.refresh_field(\"custom_material_coverage_details\");\r\n        recalc_all_child_rows(frm);\r\n\r\n    } finally {\r\n        row.__building = false;\r\n    }\r\n}\r\n\r\n\r\n/* =====================================================================\r\n   MATERIAL COVERAGE DETAILS â€“ ALL REAL-TIME CALCULATION\r\n===================================================================== */\r\nfrappe.ui.form.on(\"Material Coverage Details\", {\r\n    custom_floor_thickness: recalc_child_row,\r\n    custom_material_margin_type: recalc_child_row,\r\n    custom_material_margin_value: recalc_child_row,\r\n    labor_units: recalc_child_row,\r\n    rate_per_unit: recalc_child_row,\r\n    custom_labor_margin_type: recalc_child_row,\r\n    custom_labor_margin_value: recalc_child_row,\r\n    custom_labor_units:recalc_child_row,\r\n    custom_rate_per_unit:recalc_child_row,\r\n    unit_rate:recalc_child_row,\r\n});\r\n\r\nfunction recalc_child_row(frm, cdt, cdn) {\r\n    let ch = locals[cdt][cdn];\r\n    let wa = flt(frm.doc.custom_warehouse_area);\r\n    if (wa <= 0) return;\r\n\r\n    /* =========================\r\n       MATERIAL QUANTITY\r\n    ========================= */\r\n    let qty = 0;\r\n    let cov = flt(ch.coverage_value);\r\n    let thickness = flt(ch.custom_floor_thickness);\r\n\r\n    if (ch.custom_unit_req_po === \"Litre\") {\r\n        qty = cov ? wa * cov : wa;\r\n    } else if ([\"CUM\", \"Kg\"].includes(ch.custom_unit_req_po)) {\r\n        qty = thickness > 0 ? wa * thickness : 0;\r\n    }\r\n\r\n    frappe.model.set_value(cdt, cdn, \"quantity_needed\", qty.toFixed(3));\r\n\r\n    /* =========================\r\n       MATERIAL COST + MARGIN\r\n    ========================= */\r\n    let material_base = qty * flt(ch.unit_rate);\r\n    let mat_margin_type = ch.custom_material_margin_type || \"Percentage\";\r\n    let mat_margin_val = flt(ch.custom_material_margin_value);\r\n\r\n    let material_cost =\r\n        mat_margin_type === \"Per Unit\"\r\n            ? material_base + qty * mat_margin_val\r\n            : material_base * (1 + mat_margin_val / 100);\r\n\r\n    /* =========================\r\n       LABOR COST + MARGIN\r\n       (THIS FIXES YOUR ISSUE)\r\n    ========================= */\r\n    let labor_qty  = flt(ch.custom_labor_units);     // âœ… REAL FIELD\r\n    let labor_rate = flt(ch.custom_rate_per_unit);   // âœ… REAL FIELD\r\n\r\n    let labor_base = labor_qty * labor_rate;\r\n  \r\n    let lab_margin_type = ch.custom_labor_margin_type || \"Percentage\";\r\n    let lab_margin_val  = flt(ch.custom_labor_margin_value);\r\n\r\n    let labor_cost =\r\n        lab_margin_type === \"Per Unit\"\r\n            ? labor_base + labor_qty * lab_margin_val\r\n            : labor_base * (1 + lab_margin_val / 100);\r\n\r\n    frappe.model.set_value(\r\n        cdt,\r\n        cdn,\r\n        \"custom_final_labor_cost\",   // âœ… REAL FIELD\r\n        labor_cost.toFixed(2)\r\n    );\r\n\r\n    /* =========================\r\n       FINAL ROW TOTAL\r\n    ========================= */\r\n    let total_cost = material_cost + labor_cost;\r\n\r\n    frappe.model.set_value(\r\n        cdt,\r\n        cdn,\r\n        \"total_cost\",\r\n        total_cost.toFixed(2)\r\n    );\r\n\r\n    /* =========================\r\n       UPDATE PARENT TOTALS\r\n    ========================= */\r\n    update_parent_totals(frm, ch.custom_linked_resource_row);\r\n    \r\n    /* =========================\r\n       UPDATE PROJECT TOTALS\r\n    ========================= */\r\n    update_project_totals(frm);\r\n}\r\n\r\n/* =====================================================================\r\n   PARENT TOTALS (AGGREGATION ONLY)\r\n===================================================================== */\r\nfunction update_parent_totals(frm, parent_rowname) {\r\n    let parent = frm.doc.custom_resource_plan.find(\r\n        r => r.name === parent_rowname\r\n    );\r\n    if (!parent) return;\r\n\r\n    let total_qty = 0;\r\n    let total_cost = 0;\r\n    let total_final_labor_cost = 0;\r\n\r\n    (frm.doc.custom_material_coverage_details || [])\r\n        .filter(ch => ch.custom_linked_resource_row === parent_rowname)\r\n        .forEach(ch => {\r\n            total_qty += flt(ch.quantity_needed);\r\n            total_cost += flt(ch.total_cost);\r\n            total_final_labor_cost += flt(ch.custom_final_labor_cost);\r\n        });\r\n\r\n    frappe.model.set_value(\r\n        parent.doctype,\r\n        parent.name,\r\n        \"material_needed\",\r\n        total_qty.toFixed(3)\r\n    );\r\n\r\n    frappe.model.set_value(\r\n        parent.doctype,\r\n        parent.name,\r\n        // \"total_rs\",\r\n        \"total_material_rs\",\r\n        total_cost.toFixed(2)\r\n    );\r\n    frappe.model.set_value(\r\n        parent.doctype,\r\n        parent.name,\r\n        // \"total_rs\",\r\n        \"total_labor_rs\",\r\n        total_final_labor_cost.toFixed(2)\r\n    );\r\n    \r\n     // ðŸ”¥ THIS IS THE MISSING LINE\r\n    frm.refresh_field(\"custom_resource_plan\");\r\n}\r\n\r\nfunction update_project_totals(frm) {\r\n    let total_material = 0;\r\n    let total_labor = 0;\r\n\r\n    (frm.doc.custom_material_coverage_details || []).forEach(row => {\r\n        total_material += flt(row.total_cost);               // material + margin\r\n        total_labor += flt(row.custom_final_labor_cost);     // labor + margin\r\n    });\r\n\r\n    frm.set_value(\"custom_total_project_material_\", total_material.toFixed(2));\r\n    frm.set_value(\"custom_total_project_labor_\", total_labor.toFixed(2));\r\n    frm.set_value(\r\n        \"custom_total_project_cost_\",\r\n        (total_material + total_labor).toFixed(2)\r\n    );\r\n}\r\n\r\n\r\n/* =====================================================================\r\n   UTILITIES\r\n===================================================================== */\r\nfunction extractNumber(str) {\r\n    let m = str?.match(/[\\d.]+/);\r\n    return m ? flt(m[0]) : null;\r\n}\r\n\r\nfunction remove_old_children(frm, parent_rowname) {\r\n    frm.doc.custom_material_coverage_details =\r\n        (frm.doc.custom_material_coverage_details || [])\r\n            .filter(ch => ch.custom_linked_resource_row !== parent_rowname);\r\n\r\n    frm.refresh_field(\"custom_material_coverage_details\");\r\n}\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "FMG Floor Design",
  "enabled": 1,
  "modified": "2026-01-15 10:44:19.380672",
  "module": null,
  "name": "FMG Child Table Visibility",
  "script": "frappe.ui.form.on('FMG Floor Design', {\r\n    refresh(frm) {\r\n        toggle_tables(frm);\r\n    },\r\n\r\n    show_fmgprofloor(frm) {\r\n        toggle_tables(frm);\r\n    },\r\n\r\n    show_fmgsmartgrid(frm) {\r\n        toggle_tables(frm);\r\n    },\r\n\r\n    show_fmgadvantage(frm) {\r\n        toggle_tables(frm);\r\n    },\r\n    show_fmgadvantage_jointless(frm) {\r\n        toggle_tables(frm);\r\n    },\r\n\r\n});\r\n\r\nfunction toggle_tables(frm) {\r\n   \r\n    // FMGPROFLOOR\r\n    frm.toggle_display('fmgprofloor', frm.doc.show_fmgprofloor);\r\n\r\n    // FMGSMARTGRID\r\n    frm.toggle_display('custom_fmgsmartgrid', frm.doc.show_fmgsmartgrid);\r\n\r\n    // FMGADVANTAGE\r\n    frm.toggle_display('custom_fmgadvantage', frm.doc.show_fmgadvantage);\r\n  \r\n\r\n    // FMGADVANTAGE Jointless\r\n    frm.toggle_display('custom_fmgadvantagejointless', frm.doc.show_fmgadvantage_jointless);\r\n}\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Project",
  "enabled": 1,
  "modified": "2026-01-15 10:44:43.665902",
  "module": null,
  "name": "FMG Send Proposal",
  "script": "// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n// ðŸ“¨ Add \"Send Proposal\" Button\r\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\nfrappe.ui.form.on('Project', {\r\n    refresh: function(frm) {\r\n        // Only show button if project is saved and has items\r\n        if (frm.doc.name && frm.doc.custom_resource_plan && frm.doc.custom_resource_plan.length > 0) {\r\n        \r\n     \r\n        \r\n            frm.add_custom_button(__('Send Proposal'), () => {\r\n                send_proposal_email(frm);\r\n            }).addClass('btn-primary');\r\n        }\r\n    }\r\n});\r\n\r\n\r\nfunction send_proposal_email(frm) {\r\n    \r\n    // console.log(frm)\r\n    // return\r\n    // 1. Ensure saved\r\n    if (!frm.doc.name) {\r\n        frappe.msgprint(__('âš ï¸ Please save the project first.'));\r\n        return;\r\n    }\r\n\r\n    // 2. Ensure users table has client email\r\n    let clientEmail = null;\r\n    if (frm.doc.users && frm.doc.users.length > 0) {\r\n        // Try first user â€” or filter by role if needed\r\n        clientEmail = frm.doc.users[0].email || frm.doc.users[0].email_id;\r\n    }\r\n\r\n    if (!clientEmail) {\r\n        frappe.msgprint(__('âŒ No client email found. Please add a user with email in the \"Users\" table.'));\r\n        return;\r\n    }\r\n\r\n    console.log(\"ðŸ“§ Sending to:\", clientEmail);\r\n\r\n    frappe.call({\r\n        method: 'fmg_app.send_project_proposal',\r\n        args: { project_name: frm.doc.name },\r\n        callback: function(r) {\r\n            if (r.message) {\r\n                frappe.msgprint(r.message, __('Success'));\r\n            } else if (r.exc) {\r\n                frappe.msgprint(__('Error: ') + r.exc, __('Failed'), true);\r\n            }\r\n        },\r\n        freeze: true,\r\n        freeze_message: __('Sending proposal email...')\r\n    });\r\n}",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "FMG Floor Design",
  "enabled": 1,
  "modified": "2026-01-15 10:45:09.298081",
  "module": null,
  "name": "FMG Floor Design",
  "script": "frappe.ui.form.on('FMG Floor Design', {\r\n    refresh(frm) {\r\n        calculate_floor_level_joints(frm);\r\n    },\r\n\r\n    show_fmgprofloor(frm) {\r\n        calculate_floor_level_joints(frm);\r\n    },\r\n    show_fmgadvantage(frm) {\r\n        calculate_floor_level_joints(frm);\r\n    },\r\n    show_fmgsmartgrid(frm) {\r\n        calculate_floor_level_joints(frm);\r\n    },\r\n    show_fmgadvantage_jointless(frm) {\r\n        calculate_floor_level_joints(frm);\r\n    }\r\n});\r\n\r\n\r\nfunction calculate_floor_level_joints(frm) {\r\n\r\n    let total_control_joints = 0;\r\n    let total_armour_joints = 0;\r\n    let total_tie_bar_reinforcement = 0;\r\n    let total_top_reinforcement = 0;\r\n    let total_reinforcement = 0;\r\n\r\n    // âœ… Get ALL active tables\r\n    let active_tables = get_active_tables(frm);\r\n\r\n    if (!active_tables.length) {\r\n        frm.set_value('custom_control_joints_per_floor', 0);\r\n        frm.set_value('total_armour_joints', 0);\r\n        frm.set_value('total_length_of_joints', 0);\r\n        return;\r\n    }\r\n\r\n    // âœ… Loop through EACH active table\r\n    active_tables.forEach(table => {\r\n\r\n        table.forEach(row => {\r\n\r\n            let control_long = flt(row.custom_control_joints_per_panellongitudinal);\r\n            let control_trans = flt(row.custom_control_joints_per_paneltransverse);\r\n            let panel_size = flt(row.custom_panel_size);\r\n            let floor_size = flt(row.custom_floor_size);\r\n\r\n            let armour_long = flt(row.custom_armour_joints_per_floorlongitudinal);\r\n            let armour_trans = flt(row.custom_armour_joints_per_floortransverse);\r\n            \r\n            let cjpf = flt(row.custom_control_joints_per_floor)\r\n            let ajpf = flt(row.custom_armour_joints_per_floor)\r\n            let tbr = flt(row.custom_tie_bar_reinforcement_)\r\n            let tr = flt(row.custom_top_reinforcement)\r\n            let ctr = flt(row.custom_total_reinforcement)\r\n\r\n            // Control joints per floor (Excel logic)\r\n            if (panel_size > 0) {\r\n                total_control_joints += cjpf\r\n                total_tie_bar_reinforcement += tbr\r\n                total_top_reinforcement += tr\r\n                total_reinforcement += ctr\r\n                    // (control_long + control_trans) * (floor_size / panel_size);\r\n            }\r\n\r\n            // Armour joints per floor\r\n            total_armour_joints += ajpf;\r\n        });\r\n\r\n    });\r\n\r\n    // âœ… Set final totals on parent\r\n    frm.set_value(\r\n        'custom_control_joints_per_floor',\r\n        flt(total_control_joints, 2)\r\n    );\r\n\r\n    frm.set_value(\r\n        'custom_armour_joints_per_floor',\r\n        flt(total_armour_joints, 2)\r\n    );\r\n\r\n    frm.set_value(\r\n        'custom_tie_bar_reinforcement',\r\n        flt(total_tie_bar_reinforcement, 2)\r\n    );\r\n    frm.set_value(\r\n        'custom_top_reinforcement',\r\n        flt(total_top_reinforcement, 2)\r\n    );\r\n    frm.set_value(\r\n        'custom_total_reinforcement',\r\n        flt(total_reinforcement, 2)\r\n    );\r\n}\r\n\r\n\r\nfunction get_active_tables(frm) {\r\n    let tables = [];\r\n\r\n    if (frm.doc.show_fmgprofloor && frm.doc.fmgprofloor?.length) {\r\n        tables.push(frm.doc.fmgprofloor);\r\n    }\r\n\r\n    if (frm.doc.show_fmgadvantage && frm.doc.custom_fmgadvantage?.length) {\r\n        tables.push(frm.doc.custom_fmgadvantage);\r\n    }\r\n\r\n    if (frm.doc.show_fmgsmartgrid && frm.doc.custom_fmgsmartgrid?.length) {\r\n        tables.push(frm.doc.custom_fmgsmartgrid);\r\n    }\r\n\r\n    if (frm.doc.show_fmgadvantage_jointless && frm.doc.custom_fmgadvantagejointless?.length) {\r\n        tables.push(frm.doc.custom_fmgadvantagejointless);\r\n    }\r\n\r\n    return tables;\r\n}\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "FMG Floor Design",
  "enabled": 1,
  "modified": "2026-01-15 10:50:56.442863",
  "module": null,
  "name": "FMGSMARTGRID",
  "script": "frappe.ui.form.on(\"FMGSMARTGRID\", {\r\n    custom_floor_diemsions_length: calculate_floor_FMGSMARTGRID,\r\n    custom_floor_diemsions_width: calculate_floor_FMGSMARTGRID,\r\n    custom_column_to_column_distance_aling_the_length: calculate_floor_FMGSMARTGRID,\r\n    custom_column_to_column_distance_along_the_width: calculate_floor_FMGSMARTGRID,\r\n    custom_column_lines__inside_warehouse_along_the_length: calculate_floor_FMGSMARTGRID,\r\n    custom_panel_size__length: calculate_floor_FMGSMARTGRID,\r\n    custom_panel_size__width: calculate_floor_FMGSMARTGRID,\r\n    custom_column_pedstal__length:calculate_floor_FMGSMARTGRID,\r\n    custom_column_pedstal__width:calculate_floor_FMGSMARTGRID\r\n});\r\n\r\n// function update_parent_floor_size(frm) {\r\n//     console.log(frm.doc)\r\n//     let total_floor_size = 0;\r\n\r\n//     (frm.doc.fmgsmartgrid || []).forEach(row => {\r\n//         total_floor_size += flt(row.custom_floor_size);\r\n//     });\r\n\r\n//     frm.set_value(\"floor_size_sqm\", flt(total_floor_size, 2));\r\n// }\r\n\r\nasync function calculate_floor_FMGSMARTGRID(frm, cdt, cdn){\r\n\r\n  \r\nlet row = locals[cdt][cdn];\r\nlet custom_no_of_columns_on_perpheri_length = 0\r\nlet custom_no_of_columns_on_perphery_width = 0\r\n\r\n\r\n\r\n  let custom_floor_size = row.custom_floor_diemsions_length * row.custom_floor_diemsions_width\r\n  \r\n  frappe.model.set_value(cdt, cdn, \"custom_floor_size\", custom_floor_size);\r\n  update_parent_floor_size(frm);\r\n  \r\n  if(row.custom_floor_diemsions_length !== 0 ){\r\n      custom_no_of_columns_on_perpheri_length = row.custom_floor_diemsions_length/row.custom_column_to_column_distance_aling_the_length\r\n      frappe.model.set_value(cdt, cdn, \"custom_no_of_columns_on_perpheri_length\", Math.ceil(flt(custom_no_of_columns_on_perpheri_length,2)));\r\n  }\r\n  \r\n    \r\n    if(row.custom_floor_diemsions_width !== 0 ){\r\n        custom_no_of_columns_on_perphery_width = row.custom_floor_diemsions_width/row.custom_column_to_column_distance_along_the_width\r\n        frappe.model.set_value(cdt, cdn, \"custom_no_of_columns_on_perphery_width\", Math.ceil(flt(custom_no_of_columns_on_perphery_width,2)));\r\n    }\r\n    \r\n    let custom_no_of_columns_inside_warehouse = flt(row.custom_column_to_column_distance_along_the_width) * flt(row.custom_column_lines__inside_warehouse_along_the_length)\r\n    frappe.model.set_value(cdt, cdn, \"custom_no_of_columns_inside_warehouse\", custom_no_of_columns_inside_warehouse);\r\n    \r\n    let custom_total_no_of_columns = (flt(custom_no_of_columns_on_perpheri_length) + flt(custom_no_of_columns_on_perphery_width))*2 + flt(custom_no_of_columns_inside_warehouse)\r\n    frappe.model.set_value(cdt, cdn, \"custom_total_no_of_columns\", Math.ceil(flt(custom_total_no_of_columns,2)));\r\n    \r\n    \r\n    \r\n   \r\n    let custom_fmgsmartgrid_width = row.custom_column_to_column_distance_aling_the_length\r\n    frappe.model.set_value(cdt, cdn, \"custom_fmgsmartgrid_width\", custom_fmgsmartgrid_width);\r\n    \r\n    let custom_fmgsmartgrid_length = row.custom_column_to_column_distance_along_the_width\r\n    frappe.model.set_value(cdt, cdn, \"custom_fmgsmartgrid_length\", custom_fmgsmartgrid_length);\r\n    \r\n    //////////////////\r\n    // Math.min(flt(a), flt(b));\r\n    let custom_panel_size__length = Math.min(flt(row.custom_column_to_column_distance_aling_the_length) * 3, 21)\r\n    frappe.model.set_value(cdt, cdn, \"custom_panel_size__length\", custom_panel_size__length);\r\n    \r\n    let custom_panel_size__width = flt(row.custom_column_to_column_distance_along_the_width) * 4\r\n    frappe.model.set_value(cdt, cdn, \"custom_panel_size__width\", custom_panel_size__width);\r\n    //////////////////\r\n    \r\n    \r\n    let custom_panel_size = row.custom_panel_size__length * row.custom_panel_size__width\r\n    frappe.model.set_value(cdt, cdn, \"custom_panel_size\", custom_panel_size);\r\n    \r\n    let custom_wall_isolation_joints = (row.custom_floor_diemsions_length + row.custom_floor_diemsions_width)*2*1.05\r\n    frappe.model.set_value(cdt, cdn, \"custom_wall_isolation_joints\", custom_wall_isolation_joints);\r\n    \r\n    let custom_column_isolation_joints_periphery = (row.custom_no_of_columns_on_perpheri_length + row.custom_no_of_columns_on_perphery_width) * (row.custom_column_pedstal__length*2 + row.custom_column_pedstal__width)*1.05\r\n    frappe.model.set_value(cdt, cdn, \"custom_column_isolation_joints_periphery\", custom_column_isolation_joints_periphery);\r\n    \r\n    let custom_column_isolation_joints_internal = row.custom_no_of_columns_inside_warehouse*(row.custom_column_pedstal__length + row.custom_column_pedstal__width)*2*1.05\r\n    frappe.model.set_value(cdt, cdn, \"custom_column_isolation_joints_internal\", custom_column_isolation_joints_internal);\r\n    \r\n    let custom_total_isolation_joints = custom_wall_isolation_joints + custom_column_isolation_joints_periphery + custom_column_isolation_joints_internal\r\n    frappe.model.set_value(cdt, cdn, \"custom_total_isolation_joints\", custom_total_isolation_joints);\r\n    \r\n    let custom_control_joints_per_panellongitudinal = row.custom_panel_size__length*((row.custom_panel_size__width/row.custom_fmgsmartgrid_width) - 1)\r\n    frappe.model.set_value(cdt, cdn, \"custom_control_joints_per_panellongitudinal\", custom_control_joints_per_panellongitudinal);\r\n    \r\n    let custom_control_joints_per_paneltransverse = row.custom_panel_size__width*((row.custom_panel_size__length/row.custom_fmgsmartgrid_width) - 1)\r\n    frappe.model.set_value(cdt, cdn, \"custom_control_joints_per_paneltransverse\", custom_control_joints_per_paneltransverse);\r\n    \r\n    let custom_armour_joints_per_floorlongitudinal = row.custom_floor_diemsions_length*Math.abs(row.custom_floor_diemsions_width/row.custom_panel_size__width)\r\n    frappe.model.set_value(cdt, cdn, \"custom_armour_joints_per_floorlongitudinal\", custom_armour_joints_per_floorlongitudinal);\r\n    \r\n    let custom_armour_joints_per_floortransverse = row.custom_floor_diemsions_width*(row.custom_floor_diemsions_length/row.custom_panel_size__length)\r\n    frappe.model.set_value(cdt, cdn, \"custom_armour_joints_per_floortransverse\", custom_armour_joints_per_floortransverse);\r\n    \r\n    let custom_control_joints_per_floor = (custom_control_joints_per_panellongitudinal + custom_control_joints_per_paneltransverse)*(row.custom_floor_size/row.custom_panel_size)\r\n    frappe.model.set_value(cdt, cdn, \"custom_control_joints_per_floor\", custom_control_joints_per_floor);\r\n    \r\n    let custom_armour_joints_per_floor = custom_armour_joints_per_floorlongitudinal + custom_armour_joints_per_floortransverse\r\n    \r\n}",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "FMG Floor Design",
  "enabled": 1,
  "modified": "2026-01-15 10:51:27.305625",
  "module": null,
  "name": "FMGPROFLOOR",
  "script": "frappe.ui.form.on(\"FMGPROFLOOR\", {\r\n    custom_floor_diemsions_length: calculate_floor_FMGPROFLOOR,\r\n    custom_floor_diemsions_width: calculate_floor_FMGPROFLOOR,\r\n    custom_column_to_column_distance_aling_the_length: calculate_floor_FMGPROFLOOR,\r\n    custom_column_to_column_distance_along_the_width: calculate_floor_FMGPROFLOOR,\r\n    custom_column_lines__inside_warehouse_along_the_length: calculate_floor_FMGPROFLOOR,\r\n    custom_panel_size__length: calculate_floor_FMGPROFLOOR,\r\n    custom_panel_size__width_: calculate_floor_FMGPROFLOOR,\r\n    custom_column_pedstal__length:calculate_floor_FMGPROFLOOR,\r\n    custom_column_pedstal__width_:calculate_floor_FMGPROFLOOR\r\n});\r\n\r\n\r\nfunction update_parent_floor_size(frm) {\r\n    console.log(frm.doc)\r\n    let total_floor_size = 0;\r\n\r\n    (frm.doc.fmgprofloor || []).forEach(row => {\r\n        total_floor_size += flt(row.custom_floor_size_);\r\n    });\r\n\r\n    frm.set_value(\"floor_size_sqm\", flt(total_floor_size, 2));\r\n}\r\n\r\n\r\nasync function calculate_floor_FMGPROFLOOR(frm, cdt, cdn){\r\n\r\n  \r\nlet row = locals[cdt][cdn];\r\nlet custom_no_of_columns_on_perpheri_length = 0\r\nlet custom_no_of_columns_on_perphery_width = 0\r\n\r\n\r\n  let custom_floor_size_ = flt(row.custom_floor_diemsions_length,2) * flt(row.custom_floor_diemsions_width,2)\r\n\r\n  frappe.model.set_value(cdt, cdn, \"custom_floor_size_\", flt(custom_floor_size_,2));\r\n\r\n  update_parent_floor_size(frm);\r\n\r\n  \r\n  if(row.custom_floor_diemsions_length !== 0 ){\r\n      custom_no_of_columns_on_perpheri_length = row.custom_floor_diemsions_length/row.custom_column_to_column_distance_aling_the_length\r\n      frappe.model.set_value(cdt, cdn, \"custom_no_of_columns_on_perpheri_length\", Math.ceil(flt(custom_no_of_columns_on_perpheri_length,2)));\r\n  }\r\n  \r\n    \r\n    if(row.custom_floor_diemsions_width !== 0 ){\r\n        custom_no_of_columns_on_perphery_width = row.custom_floor_diemsions_width/row.custom_column_to_column_distance_along_the_width\r\n        frappe.model.set_value(cdt, cdn, \"custom_no_of_columns_on_perphery_width\", Math.ceil(flt(custom_no_of_columns_on_perphery_width,2)));\r\n    }\r\n    \r\n    let custom_no_of_columns_inside_warehouse_ = row.custom_column_to_column_distance_along_the_width * row.custom_column_lines__inside_warehouse_along_the_length\r\n    frappe.model.set_value(cdt, cdn, \"custom_no_of_columns_inside_warehouse_\", custom_no_of_columns_inside_warehouse_);\r\n    \r\n    let custom_total_no_of_columns = (flt(custom_no_of_columns_on_perpheri_length) + flt(custom_no_of_columns_on_perphery_width))*2 + flt(custom_no_of_columns_inside_warehouse_)\r\n    frappe.model.set_value(cdt, cdn, \"custom_total_no_of_columns\", Math.ceil(flt(custom_total_no_of_columns,2)));\r\n    \r\n    //////////////////\r\n    // Math.min(flt(a), flt(b));\r\n    let custom_panel_size__length = Math.min(flt(row.custom_column_to_column_distance_aling_the_length) * 3, 21)\r\n    frappe.model.set_value(cdt, cdn, \"custom_panel_size__length\", custom_panel_size__length);\r\n    \r\n    let custom_panel_size__width_ = flt(row.custom_column_to_column_distance_along_the_width) * 4\r\n    frappe.model.set_value(cdt, cdn, \"custom_panel_size__width_\", custom_panel_size__width_);\r\n    //////////////////\r\n    \r\n    let custom_panel_size = row.custom_panel_size__length * row.custom_panel_size__width_\r\n    frappe.model.set_value(cdt, cdn, \"custom_panel_size\", custom_panel_size);\r\n    \r\n    let custom_sawcut__along_the_width_ = row.custom_column_to_column_distance_aling_the_length/2\r\n    frappe.model.set_value(cdt, cdn, \"custom_sawcut__along_the_width_\", custom_sawcut__along_the_width_);\r\n    \r\n    let custom_sawcut__along_the_length = row.custom_column_to_column_distance_along_the_width/2\r\n    frappe.model.set_value(cdt, cdn, \"custom_sawcut__along_the_length\", custom_sawcut__along_the_length);\r\n    \r\n    \r\n    let custom_wall_isolation_joints = (row.custom_floor_diemsions_length + row.custom_floor_diemsions_width)*2*1.05\r\n    frappe.model.set_value(cdt, cdn, \"custom_wall_isolation_joints\", custom_wall_isolation_joints);\r\n    \r\n    let custom_column_isolation_joints_periphery = (row.custom_no_of_columns_on_perpheri_length + row.custom_no_of_columns_on_perphery_width) * (row.custom_column_pedstal__length*2 + row.custom_column_pedstal__width_)*1.05\r\n    frappe.model.set_value(cdt, cdn, \"custom_column_isolation_joints_periphery\", custom_column_isolation_joints_periphery);\r\n    \r\n    let custom_column_isolation_joints_internal = row.custom_no_of_columns_inside_warehouse_*(row.custom_column_pedstal__length + row.custom_column_pedstal__width_)*2*1.05\r\n    frappe.model.set_value(cdt, cdn, \"custom_column_isolation_joints_internal\", custom_column_isolation_joints_internal);\r\n    \r\n    let custom_total_isolation_joints = custom_wall_isolation_joints + custom_column_isolation_joints_periphery + custom_column_isolation_joints_internal\r\n    frappe.model.set_value(cdt, cdn, \"custom_total_isolation_joints\", custom_total_isolation_joints);\r\n    \r\n    let custom_control_joints_per_panellongitudinal = row.custom_panel_size__length*((row.custom_panel_size__width_/row.custom_sawcut__along_the_width_) - 1)\r\n    frappe.model.set_value(cdt, cdn, \"custom_control_joints_per_panellongitudinal\", custom_control_joints_per_panellongitudinal);\r\n    \r\n    let custom_control_joints_per_paneltransverse = row.custom_panel_size__width_*((row.custom_panel_size__length/row.custom_sawcut__along_the_width_) - 1)\r\n    frappe.model.set_value(cdt, cdn, \"custom_control_joints_per_paneltransverse\", custom_control_joints_per_paneltransverse);\r\n    \r\n    let custom_armour_joints_per_floorlongitudinal = row.custom_floor_diemsions_length*Math.abs(row.custom_floor_diemsions_width/row.custom_panel_size__width_)\r\n    frappe.model.set_value(cdt, cdn, \"custom_armour_joints_per_floorlongitudinal\", custom_armour_joints_per_floorlongitudinal);\r\n    \r\n    let custom_armour_joints_per_floortransverse = row.custom_floor_diemsions_width*(row.custom_floor_diemsions_length/row.custom_panel_size__length)\r\n    frappe.model.set_value(cdt, cdn, \"custom_armour_joints_per_floortransverse\", custom_armour_joints_per_floortransverse);\r\n    \r\n    let custom_control_joints_per_floor = (custom_control_joints_per_panellongitudinal + custom_control_joints_per_paneltransverse)*(row.custom_floor_size_/row.custom_panel_size)\r\n    frappe.model.set_value(cdt, cdn, \"custom_control_joints_per_floor\", custom_control_joints_per_floor);\r\n    \r\n    let custom_armour_joints_per_floor = custom_armour_joints_per_floorlongitudinal + custom_armour_joints_per_floortransverse\r\n    frappe.model.set_value(cdt, cdn, \"custom_armour_joints_per_floor\", custom_armour_joints_per_floor);\r\n}\r\n\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "FMG Floor Design",
  "enabled": 1,
  "modified": "2026-01-15 10:51:45.422056",
  "module": null,
  "name": "FMGADVANTAGE",
  "script": "frappe.ui.form.on(\"FMGADVANTAGE\", {\r\n    custom_floor_diemsions_length: calculate_floor_FMGADVANTAGE,\r\n    custom_floor_diemsions_width: calculate_floor_FMGADVANTAGE,\r\n    custom_column_to_column_distance_aling_the_length: calculate_floor_FMGADVANTAGE,\r\n    custom_column_to_column_distance_along_the_width: calculate_floor_FMGADVANTAGE,\r\n    custom_column_lines__inside_warehouse_along_the_length: calculate_floor_FMGADVANTAGE,\r\n    custom_panel_size__length: calculate_floor_FMGADVANTAGE,\r\n    custom_panel_size__width: calculate_floor_FMGADVANTAGE,\r\n    custom_column_pedstal__length:calculate_floor_FMGADVANTAGE,\r\n    custom_column_pedstal__width:calculate_floor_FMGADVANTAGE\r\n});\r\n\r\nasync function calculate_floor_FMGADVANTAGE(frm, cdt, cdn){\r\n\r\n  \r\nlet row = locals[cdt][cdn];\r\nlet custom_no_of_columns_on_perpheri_length = 0\r\nlet custom_no_of_columns_on_perphery_width = 0\r\n\r\n\r\n  let custom_floor_size = row.custom_floor_diemsions_length * row.custom_floor_diemsions_width\r\n  \r\n  frappe.model.set_value(cdt, cdn, \"custom_floor_size\", custom_floor_size);\r\n  \r\n  \r\n  if(row.custom_floor_diemsions_length !== 0 ){\r\n      custom_no_of_columns_on_perpheri_length = row.custom_floor_diemsions_length/row.custom_column_to_column_distance_aling_the_length\r\n      frappe.model.set_value(cdt, cdn, \"custom_no_of_columns_on_perpheri_length\", Math.ceil(flt(custom_no_of_columns_on_perpheri_length,2)));\r\n  }\r\n  \r\n    \r\n    if(row.custom_floor_diemsions_width !== 0 ){\r\n        custom_no_of_columns_on_perphery_width = row.custom_floor_diemsions_width/row.custom_column_to_column_distance_along_the_width\r\n        frappe.model.set_value(cdt, cdn, \"custom_no_of_columns_on_perphery_width\", Math.ceil(flt(custom_no_of_columns_on_perphery_width,2)));\r\n    }\r\n    \r\n    let custom_no_of_columns_inside_warehouse = row.custom_column_to_column_distance_along_the_width * row.custom_column_lines__inside_warehouse_along_the_length\r\n    frappe.model.set_value(cdt, cdn, \"custom_no_of_columns_inside_warehouse\", custom_no_of_columns_inside_warehouse);\r\n    \r\n    let custom_total_no_of_columns = (custom_no_of_columns_on_perpheri_length + custom_no_of_columns_on_perphery_width)*2 + custom_no_of_columns_inside_warehouse\r\n    frappe.model.set_value(cdt, cdn, \"custom_total_no_of_columns\", Math.ceil(flt(custom_total_no_of_columns,2)));\r\n    \r\n    \r\n    \r\n    // let custom_fmgadvantage__width = row.custom_column_to_column_distance_aling_the_length\r\n    // frappe.model.set_value(cdt, cdn, \"custom_fmgadvantage__width\", custom_fmgadvantage__width);\r\n    \r\n    // let custom_fmgadvantage__length = row.custom_column_to_column_distance_along_the_width\r\n    // frappe.model.set_value(cdt, cdn, \"custom_fmgadvantage__length\", custom_fmgadvantage__length);\r\n    \r\n    //////////////////\r\n    // Math.min(flt(a), flt(b));\r\n    let custom_fmgadvantage__length = Math.min(flt(row.custom_column_to_column_distance_aling_the_length) * 3, 21)\r\n    frappe.model.set_value(cdt, cdn, \"custom_fmgadvantage__length\", custom_fmgadvantage__length);\r\n    \r\n    let custom_fmgadvantage__width = flt(row.custom_column_to_column_distance_along_the_width) * 4\r\n    frappe.model.set_value(cdt, cdn, \"custom_fmgadvantage__width\", custom_fmgadvantage__width);\r\n    //////////////////\r\n    \r\n    let custom_panel_size = custom_fmgadvantage__width * custom_fmgadvantage__length\r\n    frappe.model.set_value(cdt, cdn, \"custom_panel_size\", custom_panel_size);\r\n    \r\n    // let custom_panel_size = custom_fmgadvantage__width * custom_fmgadvantage__length\r\n    // console.log(custom_fmgadvantage__width, \"--custom_fmgadvantage__width\")\r\n    console.log(custom_panel_size, \"--custom_panel_size\")\r\n    \r\n    let custom_wall_isolation_joints = (row.custom_floor_diemsions_length + row.custom_floor_diemsions_width)*2*1.05\r\n    frappe.model.set_value(cdt, cdn, \"custom_wall_isolation_joints\", custom_wall_isolation_joints);\r\n    \r\n    let custom_column_isolation_joints_periphery = (row.custom_no_of_columns_on_perpheri_length + row.custom_no_of_columns_on_perphery_width) * (row.custom_column_pedstal__length*2 + row.custom_column_pedstal__width)*1.05\r\n    frappe.model.set_value(cdt, cdn, \"custom_column_isolation_joints_periphery\", custom_column_isolation_joints_periphery);\r\n    \r\n    let custom_column_isolation_joints_internal = row.custom_no_of_columns_inside_warehouse*(row.custom_column_pedstal__length + row.custom_column_pedstal__width)*2*1.05\r\n    frappe.model.set_value(cdt, cdn, \"custom_column_isolation_joints_internal\", custom_column_isolation_joints_internal);\r\n    \r\n    let custom_total_isolation_joints = custom_wall_isolation_joints + custom_column_isolation_joints_periphery + custom_column_isolation_joints_internal\r\n    frappe.model.set_value(cdt, cdn, \"custom_total_isolation_joints\", custom_total_isolation_joints);\r\n    \r\n    let custom_control_joints_per_panellongitudinal = row.custom_panel_size__length*((row.custom_panel_size__width/row.custom_fmgadvantage__width) - 1)\r\n    frappe.model.set_value(cdt, cdn, \"custom_control_joints_per_panellongitudinal\", custom_control_joints_per_panellongitudinal);\r\n    \r\n    let custom_control_joints_per_paneltransverse = row.custom_panel_size__width*((row.custom_panel_size__length/row.custom_fmgadvantage__width) - 1)\r\n    frappe.model.set_value(cdt, cdn, \"custom_control_joints_per_paneltransverse\", custom_control_joints_per_paneltransverse);\r\n    \r\n    let custom_restrainted_joints_per_floor = custom_fmgadvantage__length*(row.custom_floor_diemsions_length/custom_fmgadvantage__width)\r\n    frappe.model.set_value(cdt, cdn, \"custom_restrainted_joints_per_floor\", custom_restrainted_joints_per_floor);\r\n    \r\n    let custom_tie_bar_reinforcement_ = (custom_restrainted_joints_per_floor/0.15)*0.9*2.4*2*1.03\r\n    frappe.model.set_value(cdt, cdn, \"custom_tie_bar_reinforcement_\", custom_tie_bar_reinforcement_);\r\n    \r\n    let custom_top_reinforcement = custom_floor_size*8.5\r\n    frappe.model.set_value(cdt, cdn, \"custom_top_reinforcement\", custom_top_reinforcement);\r\n    \r\n    let custom_total_reinforcement = custom_tie_bar_reinforcement_ + custom_top_reinforcement\r\n    frappe.model.set_value(cdt, cdn, \"custom_total_reinforcement\", custom_total_reinforcement);\r\n    \r\n    \r\n}",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "FMG Floor Design",
  "enabled": 1,
  "modified": "2026-01-15 10:52:02.457062",
  "module": null,
  "name": "FMGADVANTAGE-JOINTLESS",
  "script": "frappe.ui.form.on(\"FMGADVANTAGE-JOINTLESS\", {\r\n    custom_floor_diemsions_length: calculate_floor_FMGADVANTAGE_JOINTLESS,\r\n    custom_floor_diemsions_width: calculate_floor_FMGADVANTAGE_JOINTLESS,\r\n    custom_column_to_column_distance_aling_the_length: calculate_floor_FMGADVANTAGE_JOINTLESS,\r\n    custom_column_to_column_distance_along_the_width: calculate_floor_FMGADVANTAGE_JOINTLESS,\r\n    custom_column_lines__inside_warehouse_along_the_length: calculate_floor_FMGADVANTAGE_JOINTLESS,\r\n    custom_panel_size__length: calculate_floor_FMGADVANTAGE_JOINTLESS,\r\n    custom_panel_size__width: calculate_floor_FMGADVANTAGE_JOINTLESS,\r\n    custom_column_pedstal__length:calculate_floor_FMGADVANTAGE_JOINTLESS,\r\n    custom_column_pedstal__width:calculate_floor_FMGADVANTAGE_JOINTLESS\r\n});\r\n\r\nasync function calculate_floor_FMGADVANTAGE_JOINTLESS(frm, cdt, cdn){\r\n\r\n  \r\nlet row = locals[cdt][cdn];\r\nlet custom_no_of_columns_on_perpheri_length = 0\r\nlet custom_no_of_columns_on_perphery_width = 0\r\n\r\n\r\n  let custom_floor_size = row.custom_floor_diemsions_length * row.custom_floor_diemsions_width\r\n  \r\n  frappe.model.set_value(cdt, cdn, \"custom_floor_size\", custom_floor_size);\r\n  \r\n  \r\n  if(row.custom_floor_diemsions_length !== 0 ){\r\n      custom_no_of_columns_on_perpheri_length = row.custom_floor_diemsions_length/row.custom_column_to_column_distance_aling_the_length\r\n      frappe.model.set_value(cdt, cdn, \"custom_no_of_columns_on_perpheri_length\", Math.ceil(flt(custom_no_of_columns_on_perpheri_length,2)));\r\n  }\r\n  \r\n    \r\n    if(row.custom_floor_diemsions_width !== 0 ){\r\n        custom_no_of_columns_on_perphery_width = row.custom_floor_diemsions_width/row.custom_column_to_column_distance_along_the_width\r\n        frappe.model.set_value(cdt, cdn, \"custom_no_of_columns_on_perphery_width\", Math.ceil(flt(custom_no_of_columns_on_perphery_width,2)));\r\n    }\r\n    \r\n    let custom_no_of_columns_inside_warehouse = row.custom_column_to_column_distance_along_the_width * row.custom_column_lines__inside_warehouse_along_the_length\r\n    frappe.model.set_value(cdt, cdn, \"custom_no_of_columns_inside_warehouse\", custom_no_of_columns_inside_warehouse);\r\n    \r\n    let custom_total_no_of_columns = (custom_no_of_columns_on_perpheri_length + custom_no_of_columns_on_perphery_width)*2 + custom_no_of_columns_inside_warehouse\r\n    frappe.model.set_value(cdt, cdn, \"custom_total_no_of_columns\", Math.ceil(flt(custom_total_no_of_columns,2)));\r\n    \r\n    \r\n    \r\n    let custom_fmgadvantage__width = row.custom_column_to_column_distance_aling_the_length\r\n    frappe.model.set_value(cdt, cdn, \"custom_fmgadvantage__width\", custom_fmgadvantage__width);\r\n    \r\n    let custom_fmgadvantage__length = row.custom_column_to_column_distance_along_the_width\r\n    frappe.model.set_value(cdt, cdn, \"custom_fmgadvantage__length\", custom_fmgadvantage__length);\r\n    \r\n    //////////////////\r\n    // Math.min(flt(a), flt(b));\r\n    let custom_panel_size__length = Math.min(flt(row.custom_column_to_column_distance_aling_the_length) * 3, 21)\r\n    frappe.model.set_value(cdt, cdn, \"custom_panel_size__length\", custom_panel_size__length);\r\n    \r\n    let custom_panel_size__width = flt(row.custom_column_to_column_distance_along_the_width) * 4\r\n    frappe.model.set_value(cdt, cdn, \"custom_panel_size__width\", custom_panel_size__width);\r\n    //////////////////\r\n    \r\n    let custom_panel_size = custom_fmgadvantage__width * custom_fmgadvantage__length\r\n    frappe.model.set_value(cdt, cdn, \"custom_panel_size\", custom_panel_size);\r\n    \r\n    let custom_sawcut__along_the_width_ = row.custom_column_to_column_distance_aling_the_length/2\r\n    frappe.model.set_value(cdt, cdn, \"custom_sawcut__along_the_width_\", custom_sawcut__along_the_width_);\r\n    \r\n    let custom_sawcut__along_the_length = row.custom_column_to_column_distance_along_the_width/2\r\n    frappe.model.set_value(cdt, cdn, \"custom_sawcut__along_the_length\", custom_sawcut__along_the_length);\r\n\r\n    \r\n    let custom_wall_isolation_joints = (row.custom_floor_diemsions_length + row.custom_floor_diemsions_width)*2*1.05\r\n    frappe.model.set_value(cdt, cdn, \"custom_wall_isolation_joints\", custom_wall_isolation_joints);\r\n    \r\n    let custom_column_isolation_joints_periphery = (row.custom_no_of_columns_on_perpheri_length + row.custom_no_of_columns_on_perphery_width) * (row.custom_column_pedstal__length*2 + row.custom_column_pedstal__width)*1.05\r\n    frappe.model.set_value(cdt, cdn, \"custom_column_isolation_joints_periphery\", custom_column_isolation_joints_periphery);\r\n    \r\n    let custom_column_isolation_joints_internal = row.custom_no_of_columns_inside_warehouse*(row.custom_column_pedstal__length + row.custom_column_pedstal__width)*2*1.05\r\n    frappe.model.set_value(cdt, cdn, \"custom_column_isolation_joints_internal\", custom_column_isolation_joints_internal);\r\n    \r\n    let custom_total_isolation_joints = custom_wall_isolation_joints + custom_column_isolation_joints_periphery + custom_column_isolation_joints_internal\r\n    frappe.model.set_value(cdt, cdn, \"custom_total_isolation_joints\", custom_total_isolation_joints);\r\n    \r\n    let custom_control_joints_per_panellongitudinal = row.custom_panel_size__length*((row.custom_panel_size__width/row.custom_fmgadvantage__width) - 1)\r\n    frappe.model.set_value(cdt, cdn, \"custom_control_joints_per_panellongitudinal\", custom_control_joints_per_panellongitudinal);\r\n    \r\n    let custom_control_joints_per_paneltransverse = row.custom_panel_size__width*((row.custom_panel_size__length/row.custom_fmgadvantage__width) - 1)\r\n    frappe.model.set_value(cdt, cdn, \"custom_control_joints_per_paneltransverse\", custom_control_joints_per_paneltransverse);\r\n    \r\n    let custom_control_joints_per_floor = (custom_control_joints_per_panellongitudinal + custom_control_joints_per_paneltransverse)*(row.custom_floor_size_/row.custom_panel_size)\r\n    frappe.model.set_value(cdt, cdn, \"custom_control_joints_per_floor\", custom_control_joints_per_floor);\r\n    \r\n    let custom_armour_joints_per_floor = custom_armour_joints_per_floorlongitudinal + custom_armour_joints_per_floortransverse\r\n    frappe.model.set_value(cdt, cdn, \"custom_armour_joints_per_floor\", custom_armour_joints_per_floor);\r\n    \r\n    \r\n}",
  "view": "Form"
 }
]